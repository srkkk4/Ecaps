## Nim 游戏

<br>

#### - Nim 游戏

Nim 游戏是一种公平博弈的组合游戏, 标准的 Nim 游戏定义如下 : 

给定石子堆集合 $S = \{a_i\}, |S| = n$,  A 与 B 轮流操作, 每次操作可以任选一堆石子 $a_i > 0$, 拿走 $k \in [1, a_i]$ 个石子, 即 $a_i \leftarrow a_i - k$, 不能操作者输, 问先手必胜还是必败

对于这种问题的研究, 一般难以构造方案, 只能模拟比较小的情况, 找出规律

现在给出一种系统的分析方法, 但这种方法本质上是构造结论, 需要去凑规律能够 " 自圆其说 " ( 采用数学归纳法 ), 发挥人类智慧

现在给出结论, 设 $\delta = \bigoplus_{i = 1}^n a_i$ ( 其中 $\oplus$ 表示异或运算 ), 若 $\delta = 0$ 则先手必败, 否则先手必胜

虽然这个玩意看起来与原问题十分不搭边, 但经过下面的论证不难发现其正确性

<br>

首先给出一些定义

对于任意一个时刻的局面 / 状态 $A$, 如果当前操作的人有一种策略使得他最终能够取胜, 那么我们称这个状态为 **先手必胜态** ( N - position, N 状态 ), 如果当前操作的人无论如何最终都会失败, 那么称这个状态为 **先手必败态** ( P - position, P 状态 ), 不难发现, 对于任意一个状态 $A$, 它要么是 N, 要么是 P

那么两个基本事实是 :

* 如果当前游戏处于 N 状态, 那么 **存在** 一种策略 / 操作, 使得执行完这个操作后, 这个游戏将处于 P 状态

* 如果当前游戏处于 P 状态, 那么 **不存在** 一种策略 / 操作, 使得执行完这个操作后, 这个游戏将处于 P 状态 ( 换言之, 任何一种操作都将导致游戏进入到 N 状态 )

上面的事实将对我们接下来的论证大有裨益

<br>

回到原问题, 假设结论成立 ( 即 $\delta = 0$, 则游戏处于 P 状态, 否则处于 N 状态 ), 归纳证明结论正确性 : 

1. 对于局面 $S = \{0\}$, 结论显然成立

2. 若 $\delta = 0$, 假设我们存在一种策略使得 $\delta' = 0$ ( 即操作完后局面依然为 P 状态, 等价于先手可以胜利 ), 不妨设这个操作是拿走第 $i$ 堆的 $k$ 个石子, 即 $a_i \leftarrow a_i - k$, 那么有 $\delta' = \delta \oplus a_i \oplus (a_i - k) = a_i \oplus (a_i - k) \not= 0$, 这一段式子的正确性是显然的, 这就意味着不存在一种策略使得先手获胜

3. 对于 $\delta \not= 0$, 我们尝试构造一种策略使得 $\delta' = 0$, 那么就是要让一堆 $a_i$ 变成 $a_i \oplus \delta$, 满足 $a_i \oplus \delta < a_i$, 万幸的是, 一定存在这样一堆石子
   
   直接考虑 $\delta$ 的二进制最高位 $2^k$, 找到一堆石子 $a_i$, 满足 $a_i \text{ and } 2^k = 2^k$ ( $\text{and}$ 表示按位与 ), 一定存在这样的石子堆, 不然$\delta$ 的 $2^k$ 位一定是 $0$, 显然有 $a_i \oplus \delta < a_i$

上面就是 Nim 游戏的基本内容, 这对 sg 函数有很大的启发性与帮助

<br>

#### - 参考

[csdn blog](https://blog.csdn.net/strangedbly/article/details/51137432)

[cnblogs](https://www.cnblogs.com/usedrosee/p/4693624.html)
